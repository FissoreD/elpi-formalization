
%              inp           inp  out   out
% \inferCmdArr{optional-vec}{trm}{det}{good-call}
\newcommand{\inferCmdArr}[4][]{\ensuremath{
    \ifstrequal{#1}{1}
    {(\infer\ #2)\ #3}
    {\infer\ #2\ #3} \arr #4
  }}
\newcommand{\dapp}{\ensuremath{\texttt{deduce}_@\xspace}}

\newcommand{\ruleInfer}[2]{\customlabel{#1}{\ensuremath{D_{#2}}}}

\newcommand{\ruleInferCut}{\ruleInfer{rule:infer-cut}{!}}
\newcommand{\inferCut}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleInferCut}
    \UnaryInfC{\inferCmdArr{\ctx}{\cut}{(\detI, \top)}}
  \end{myRule}
}

\newcommand{\ruleInferPiImpl}{\ruleInfer{rule:infer-piimpl}{\piimpl}}
\newcommand{\inferPiImpl}[1]{
  \begin{myRule}{#1}
    \AxiomC{\inferCmdArr{(\ctx + \{x \mapsto ty\})}{B}{\res}}
    \RightLabelM{\ruleInferPiImpl}
    \UnaryInfC{\inferCmdArr{\ctx}{(\piImplCmd[ty]{x}{H}{B})}{\res}}
  \end{myRule}
}

\newcommand{\ruleInferUnif}{\ruleInfer{rule:infer-unif}{=}}
\newcommand{\inferUnif}[1]{
  % UNIF
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleInferUnif}
    \UnaryInfC{\inferCmdArr{\ctx}{(\_ = \_)}{(\detI,\top)}}
  \end{myRule}
}

\newcommand{\ruleInferApp}{\ruleInfer{rule:infer-app}{@}}
\newcommand{\inferApp}[1]{
  % APP
  \begin{myRule}{#1}
    % \AxiomC{\ensuremath{\ctx\ \predVar = \dtype{\func[']}{\func[_i]}{\_}}}
    % \AxiomC{\inferCmdArr[1]{\ctx}{t_i}{\func[_i']}{\_}}
    \AxiomC{\ensuremath{\ctx\ \predVar = \dtype{\func}{\func[_i]}{\func[_o]}}}
    \AxiomC{\dappCmd{\ctx}{\func[_i]}{\func[_o]}{\vec{t}}{\top}{(\func['_i],\func['_o],\bool)}}
    \RightLabelM{\ruleInferApp}
    \BinaryInfC{\inferCmdArr{\ctx}{(\predVar\ \vec{t})}{(\dtype{\func}{\func['_i]}{\func['_o]}, \bool)}}
  \end{myRule}
}

\newcommand{\ruleInferExp}{\ruleInfer{rule:infer-hd}{\expr}}
\newcommand{\InferExp}[1]{
  \begin{myRule}{#1}
    \AxiomC{  }
    \RightLabelM{\ruleInferExp}
    \UnaryInfC{\inferCmdArr{\ctx}{\expr}{(\expI,\top)}}
  \end{myRule}
}

\newcommand{\ruleInferLam}{\ruleInfer{rule:infer-lam}{\lambda}}
\newcommand{\inferLam}[1]{
  \begin{myRule}{#1}
    \AxiomC{\inferCmdArr{(\ctx + \{x:ty\})}{t}{(\func, \bool)}}
    \RightLabelM{\ruleInferLam}
    \UnaryInfC{\inferCmdArr{\ctx}{(\lambda x:\func[_i].\lambda y:\func[_o].t)}{(\dtype{\func}{\func[_i]}{\func[_o]},\bool)}}
  \end{myRule}
}

\newcommand{\ruleInferAppRef}[2]{\customlabel{#1}{\ensuremath{D@_{#2}}}}
% dappCmd[ctx][detInput][detOutput][args][goodCall][res]
\newcommand{\dappCmd}[6]{\ensuremath{\dapp\ #1\ #2\ #3\ #4\ #5 \arr #6}}
\newcommand{\inferAppEmptyRef}{\ruleInferAppRef{rule:inferAppEmpty}{\EmptyList}}
\newcommand{\inferAppEmpty}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\inferAppEmptyRef}
    \UnaryInfC{\dappCmd{\ctx}{\func[_i]}{\func[_o]}{\EmptyList}{\bool}{(\func[_i],\func[_o], \bool)}}
  \end{myRule}
}

\newcommand{\inferAppEmptyDORef}{\ruleInferAppRef{rule:inferAppEmptyDO}{o}}
\newcommand{\inferAppEmptyDO}[1]{
  \begin{myRule}{#1}
    \AxiomC{\dappCmd{\ctx}{\EmptyList}{\func[_o]}{\vec{t}}{\bool}{\res}}
    \RightLabelM{\inferAppEmptyDORef}
    \UnaryInfC{\dappCmd{\ctx}{\EmptyList}{(\_ :: \func[_o])}{(\_ :: \vec{t})}{\bool}{\res}}
  \end{myRule}
}

\newcommand{\inferAppEmptyDIRef}{\ruleInferAppRef{rule:inferAppEmptyDI}{\bot}}
\newcommand{\inferAppEmptyDI}[1]{
  \begin{myRule}{#1}
    \AxiomC{\ensuremath{\bool = \bot \quad \dappCmd{\ctx}{\func[_i]}{\func[_o]}{\vec{t}}{\bot}{\res}}}
    \RightLabelM{\inferAppEmptyDIRef}
    \UnaryInfC{\dappCmd{\ctx}{(\_ :: \func[_i])}{\func[_o]}{(t :: \vec{t})}{\bool}{\res}}
  \end{myRule}
}

\newcommand{\inferAppEmptyDIOKRef}{\ruleInferAppRef{rule:inferAppEmptyDIOK}{\bot}}
\newcommand{\inferAppEmptyDIOK}[1]{
  \begin{myRule}{#1}
    \AxiomC{\ensuremath{\bool = \top \quad \inferCmdArr{\ctx}{t}{\func[']}{\bool'} \quad \dappCmd{\ctx}{\func[_i]}{\func[_o]}{\vec{t}}{(\bool' \land \func' \mySub \func)}{\res}}}
    \RightLabelM{\inferAppEmptyDIOKRef}
    \UnaryInfC{\dappCmd{\ctx}{(\func :: \func[_i])}{\func[_o]}{(t :: \vec{t})}{\bool}{\res}}
  \end{myRule}
}

\newcommand{\inferFig}{
  \begin{subfigure}[b]{1\textwidth}
    \centering
    \InferExp{0.27}
    \inferCut{0.30}
    % \inferUnif{0.31}

    % \inferPiImpl{0.44}
    \inferLam{.5}

    \inferApp{1}

    % \inferAppFail{1}
%     \caption{\infer\ relation}
%     \label{fig:det-inference}
%   \end{subfigure}
% }

% \newcommand{\inferAppFig}{
%   \begin{subfigure}[b]{1\textwidth}

    \inferAppEmpty{.45}
    \inferAppEmptyDO{.45}
    \inferAppEmptyDI{1}
    \inferAppEmptyDIOK{1}

    % \caption{\infer}
    \label{fig:det-inference}
  \end{subfigure}
}