
%              inp  inp  out   out
% \inferCmdArr{ctx}{trm}{det}{good-call}
\newcommand{\inferCmdArr}[4]{\ensuremath{\infer\ #1\ #2 \arr (#3, #4)}}

\newcommand{\ruleInfer}[2]{\customlabel{#1}{\ensuremath{D_{#2}}}}

\newcommand{\ruleInferCut}{\ruleInfer{rule:infer-cut}{!}}
\newcommand{\inferCut}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleInferCut}
    \UnaryInfC{\inferCmdArr{\ctx}{\cut}{\detI}{\top}}
  \end{myRule}
}

\newcommand{\ruleInferPiImpl}{\ruleInfer{rule:infer-piimpl}{\piimpl}}
\newcommand{\inferPiImpl}[1]{
  \begin{myRule}{#1}
    \AxiomC{\inferCmdArr{(\ctx + \{x \mapsto ty\})}{B}{\func}{\mathcal{R}}}
    \RightLabelM{\ruleInferPiImpl}
    \UnaryInfC{\inferCmdArr{\ctx}{(\piImplCmd[ty]{x}{H}{B})}{\func}{\mathcal{R}}}
  \end{myRule}
}

\newcommand{\ruleInferUnif}{\ruleInfer{rule:infer-unif}{=}}
\newcommand{\inferUnif}[1]{
  % UNIF
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleInferUnif}
    \UnaryInfC{\inferCmdArr{\ctx}{(\_ = \_)}{\detI}{\top}}
  \end{myRule}
}

\newcommand{\ruleInferApp}{\ruleInfer{rule:infer-app}{@}}
\newcommand{\inferApp}[1]{
  % APP
  \begin{myRule}{#1}
    \AxiomC{\ensuremath{\ctx\ \predVar = \dtype{\func[']}{[\func[_i]]}{\_}}}
    \AxiomC{\inferCmdArr{\ctx}{i}{\func[_i']}{\_}}
    % \AxiomC{\ensuremath{\func[_i'] \mySub \func[_i]}}
    % \AxiomC{\ensuremath{\get{i}\ \predVar = D\ [D_1^E, \_]}}
    % \AxiomC{$D_1 \mySub \get{i} \predVar$}
    \RightLabelM{\ruleInferApp}
    \BinaryInfC{\inferCmdArr{\ctx}{(\predVar\ i\ o)}{\func[']}{\func[_i'] \mySub \func[_i]}}
  \end{myRule}
}

\newcommand{\ruleInferExp}{\ruleInfer{rule:infer-hd}{\expr}}
\newcommand{\InferExp}[1]{
  \begin{myRule}{#1}
    \AxiomC{  }
    \RightLabelM{\ruleInferExp}
    \UnaryInfC{\inferCmdArr{\ctx}{\expr}{\expI}{\top}}
  \end{myRule}
}

\newcommand{\inferFig}{
  \begin{subfigure}[b]{1\textwidth}
    \centering
    \InferExp{0.27}
    \inferCut{0.30}
    \inferUnif{0.31}
    
    \inferPiImpl{0.46}
    \inferApp{0.49}

    % \inferAppFail{1}
    \caption{\infer\ relation}
    \label{fig:det-inference}
  \end{subfigure}
}