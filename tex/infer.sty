%              inp  inp  out
% \inferCmdArr{ctx}{trm}{det}
\newcommand{\inferCmdArr}[3]{\ensuremath{\inferCmd{#1}{#2} \arr #3}}

\newcommand{\ruleInfer}[2]{\customlabel{#1}{\ensuremath{I_{#2}}}}

\newcommand{\ruleInferCut}{\ruleInfer{rule:infer-cut}{!}}
\newcommand{\inferCut}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleInferCut}
    \UnaryInfC{\inferCmdArr{\ctx}{\cut}{\detI}}
  \end{myRule}
}

\newcommand{\ruleInferPiImpl}{\ruleInfer{rule:infer-piimpl}{\piimpl}}
\newcommand{\inferPiImpl}[1]{
  \begin{myRule}{#1}
    \AxiomC{\inferCmdArr{(\ctx + \{x \mapsto ty\})}{B}{\func}}
    \RightLabelM{\ruleInferPiImpl}
    \UnaryInfC{\inferCmdArr{\ctx}{(\piImplCmd[ty]{x}{H}{B})}{\func}}
  \end{myRule}
}

\newcommand{\ruleInferUnif}{\ruleInfer{rule:infer-unif}{=}}
\newcommand{\inferUnif}[1]{
  % UNIF
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleInferUnif}
    \UnaryInfC{\inferCmdArr{\ctx}{(\_ = \_)}{\detI}}
  \end{myRule}
}

\newcommand{\ruleInferApp}{\ruleInfer{rule:infer-app}{@}}
\newcommand{\inferApp}[1]{
  % APP
  \begin{myRule}{#1}
    \AxiomC{\inferCmdArr{\ctx}{t_1}{\func}}
    \AxiomC{\inferCmdArr{\ctx}{t}{\func[']\ [\func[_i]]\ \_}}
    \AxiomC{\ensuremath{\func \mySub \func[_i]}}
    % \AxiomC{\ensuremath{\get{i}\ \predVar = D\ [D_1^E, \_]}}
    % \AxiomC{$D_1 \mySub \get{i} \predVar$}
    \RightLabelM{\ruleInferApp}
    \TrinaryInfC{\inferCmdArr{\ctx}{(t\ t_1\ t_2)}{\func[']}}
  \end{myRule}
}

\newcommand{\ruleInferHd}{\ruleInfer{rule:infer-hd}{\predVar}}
\newcommand{\inferHd}[1]{
  \begin{myRule}{#1}
    % \AxiomC{\inferCmdArr{\ctx}{t_1}{\func}}
    % \AxiomC{\inferCmdArr{\ctx}{\predVar}{\func[']\ [\func[_i]]\ \_}}
    % \AxiomC{\ensuremath{\get{i}\ \predVar = D\ [D_1^E, \_]}}
    % \AxiomC{$D_1 \mySub \get{i} \predVar$}
    \AxiomC{}
    \RightLabelM{\ruleInferHd}
    \UnaryInfC{\inferCmdArr{\ctx}{\predVar}{\ctx\ \predVar}}
  \end{myRule}
}

\newcommand{\inferFig}{
  \begin{figure}
    \centering
    \inferHd{0.24}
    \inferUnif{0.28}
    \inferPiImpl{0.4}

    \inferCut{0.27}
    \inferApp{0.67}
    % \inferAppFail{1}
    \caption{Determinacy inference}
    \label{fig:det-inference}
  \end{figure}
}