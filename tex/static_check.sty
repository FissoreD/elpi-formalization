
% [checkCmd ctx1 func1 tm ctx2 func2]
\newcommand{\checkL}{\texttt{check}\ensuremath{_L}}
\newcommand{\checkCmd}[5]{\ensuremath{(#1, #2) \vdash \checkk\ #3 \arr (#4, #5)}}
\newcommand{\checkLCmd}[5]{\ensuremath{(#1, #2) \vdash \checkL\ #3 \arr (#4, #5)}}
\newcommand{\checkClause}[2]{\ensuremath{#1 \vdash \checkc\ #2}}

% \newcommand{\ruleCheckName}[1]{\ensuremath{C_{#1}}\xspace}
\newcommand{\ruleCheckName}[2]{\customlabel{#1}{\ensuremath{C_{#2}}}}

\newcommand{\ruleCheckClause}{\ruleCheckName{rule:check-clause}{\cdash}}
\newcommand{\ruleCheckClauseM}[1]{
  \begin{myRule}{#1}
    % Clause
    \AxiomC{\assumeCmd{\ctx}{(\get{i}\ \pred)}{i}{\ctx[']}}
    \AxiomC{\checkCmd{\ctx[']}{\detI}{B}{\ctx['']}{\func}}
    \AxiomC{\subCmd{\inferCmd{\ctx['']}{o}}{\getO{\pred}}}
    \AxiomC{\subCmd{\func}{\getF{\pred}}}
    \RightLabelM{\ruleCheckClause}
    \QuaternaryInfC{\checkClause{\ctx}{(\clauseCmd{\pred}{i\ o}{B})}}
  \end{myRule}
}

\newcommand{\ruleCheckCut}{\ruleCheckName{rule:check-cut}{!}}
\newcommand{\ruleCheckCutM}[1]{
  \begin{myRule}{#1}
    % CUT
    \AxiomC{}
    \RightLabelM{\ruleCheckCut}
    \UnaryInfC{\checkCmd{\ctx}{\_}{\cut}{\ctx}{\detI}}
  \end{myRule}
}

\newcommand{\ruleCheckUnif}{\ruleCheckName{rule:check-unif}{=}}
\newcommand{\ruleCheckUnifM}[1]{
  \begin{myRule}{#1}
    % UNIF
    \AxiomC{
      \stackanchor
      {\ensuremath{\inferCmdArr{\ctx}{A}{\func[_A]}}}
      {\ensuremath{\inferCmdArr{\ctx}{B}{\func[_B]}}}}
    \AxiomC{\ensuremath{\func{_{AB}} = \minT\ \func{_A}\ \func{_B}}}
    % \AxiomC{\ensuremath{\func{_{AB}} = \minT\ \func{_A}\ \func{_B}}}
    \AxiomC{
      \stackanchor
        {\ensuremath{\assumeCmd{\ctx}{\func{_{AB}}}{A}{\ctx[']}}}
        {\ensuremath{\assumeCmd{\ctx[']}{\func{_{AB}}}{B}{\ctx['']}}}}
    \RightLabelM{\ruleCheckUnif}
    \TrinaryInfC{\checkCmd{\ctx}{\func}{(A = B)}{\ctx['']}{\func}}
  \end{myRule}
}

% \newcommand{\ruleCheckMatch}{\ruleCheckName{m}}
% \newcommand{\ruleCheckMatchM}[1]{
%   \begin{myRule}{#1}
%     % MATCH
%     \AxiomC{\checkCmd{\ctx + \{A \mapsto B; B \mapsto \min A\ B\}}{\func}{L}{\ctx[']}{\func[']}}
%     \RightLabelM{\ruleCheckMatch}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{A = B}\ConsTl{L}}{\ctx[']}{\func[']}}
%   \end{myRule}
% }

% \newcommand{\ruleCheckImpl}{\ruleCheckName{\Rightarrow}}
% \newcommand{\ruleCheckImplM}[1]{
%   \begin{myRule}{#1}
%     % IMPL
%     % \AxiomC{\checkClause{\ctx}{H}}
%     \AxiomC{\checkCmd{\ctx}{\func}{\ConsHd{B}\ConsTl{L}}{\ctx[']}{\func[']}}
%     \RightLabelM{\ruleCheckImpl}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{\implCmd{H}{B}}\ConsTl{L}}{\ctx[']}{\func[']}}
%   \end{myRule}
% }

% \newcommand{\ruleCheckPi}{\ruleCheckName{\forall}}
% \newcommand{\ruleCheckPiM}[1]{
%   \begin{myRule}{#1}
%     % PI
%     \AxiomC{\checkCmd{\ctx + \{x \mapsto \toF\ x\}}{\func}{\ConsHd{B}\ConsTl{L}}{\ctx[']}{\func[']}}
%     \RightLabelM{\ruleCheckPi}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{\piCmd{x}{B}}\ConsTl{L}}{\ctx[']}{\func[']}}
%   \end{myRule}
% }

\newcommand{\ruleCheckPiImpl}{\ruleCheckName{rule:check-ho}{\piimpl}}
\newcommand{\ruleCheckPiImplM}[1]{
  \begin{myRule}{#1}
    % PiImpl
    \AxiomC{\checkClause{\ctx}{H}}
    \AxiomC{\checkCmd{\ctx + \{x \mapsto ty\}}{\func}{B}{\ctx[']}{\func[']}}
    \RightLabelM{\ruleCheckPiImpl}
    \BinaryInfC{\checkCmd{\ctx}{\func}{(\piImplCmd[ty]{x}{H}{B})}{\ctx[']}{\func[']\bs \{x\}}}
  \end{myRule}
}

\newcommand{\predVar}{\texttt{v}}

\newcommand{\ruleCheckCall}{\ruleCheckName{rule:check-callOK}{@}}
\newcommand{\ruleCheckCallM}[1]{
  \begin{myRule}{#1}
    % CALL SUCC
    \AxiomC{\ensuremath{\ctx\ \predVar = \dtype{\func[']}{[\func[_i]]}{[\func[_o]]}}}
    \AxiomC{\inferCmdArr{\ctx}{i}{\func[_i']}}
    \AxiomC{\ensuremath{\func[_i'] \mySub \func[_i]}}
    \AxiomC{\assumeCmd{\ctx}{\func[_o]}{o}{\ctx[']}}
    \RightLabelM{\ruleCheckCall}
    \QuaternaryInfC{\checkCmd{\ctx}{\func}{(\predVar\ i\ o)}{\ctx[']}{\maxT\ \func\ \func[']}}
  \end{myRule}
}

\newcommand{\ruleCheckCallFail}{\ruleCheckName{rule:check-callKO}{\bot}}
\newcommand{\ruleCheckCallFailM}[1]{
  \begin{myRule}{#1}
    % CALL FAIL
    \AxiomC{$\lnot (\ctx\ \predVar = \dtype{\func[']}{[\func[_i]]}{[\func[_o]]} \land \inferCmdArr{\ctx}{i}{\_})$}
    \RightLabelM{\ruleCheckCallFail}
    \UnaryInfC{\checkCmd{\ctx}{\_}{(\predVar\ i\ o)}{\ctx + \UCmd{\ctx}{\bot}{o}}{\relI}}
  \end{myRule}
}


% \newcommand{\ruleCheckEmptyM}[1]{
%   \begin{myRule}{#1}
%     % EMPTY
%     \AxiomC{}
%     \RightLabelM{\ruleCheckEmpty}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\EmptyList}{\ctx}{\func}}
%   \end{myRule}
% }

\newcommand{\ruleCheckEmpty}{\ruleCheckName{rule:check-stop}{\EmptyList}}
\newcommand{\ruleCheckListEmpty}[1]{
  % EMPTY
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleCheckEmpty}
    \UnaryInfC{\checkLCmd{\ctx}{\func}{\EmptyList}{\ctx}{\func}}
  \end{myRule}
}

\newcommand{\ruleCheckCons}{\ruleCheckName{rule:check-cons}{::}}
\newcommand{\ruleCheckListCons}[1]{
  % CONS
  \begin{myRule}{#1}
    \AxiomC{\checkCmd{\ctx}{\func}{\EmptyList}{\ctx[']}{\func[']}}
    \AxiomC{\checkLCmd{\ctx[']}{\func[']}{\EmptyList}{\ctx['']}{\func['']}}
    \RightLabelM{\ruleCheckCons}
    \BinaryInfC{\checkLCmd{\ctx}{\func}{\ConsHd{h}\ConsTl{t}}{\ctx['']}{\func['']}}
  \end{myRule}
}

\newcommand{\checkTermFig}{
  \begin{subfigure}[b]{1\textwidth}
    \centering
    
    \ruleCheckCutM{.45}
  
    % \ruleCheckPiM{.5}
    \ruleCheckPiImplM{1}
  
    \ruleCheckUnifM{1}
  
    % \ruleCheckMatchM{.7}
    \ruleCheckCallM{1}
    \ruleCheckCallFailM{1}
  
    \caption{\checkk\ relation}
    \label{fig:static-check-term}
  \end{subfigure}
}

\newcommand{\staticCheckFig}{
  \begin{figure}
    \centering
    \ruleCheckClauseM{1}

    \ruleCheckListEmpty{.38}
    \ruleCheckListCons{1}

    \caption{Determinacy clause checking}
    \label{fig:static-check}
  \end{figure}
}