
% [checkCmd ctx1 func1 tm ctx2 func2]
\newcommand{\checkCmd}[5]{\ensuremath{(#1, #2) \vdash \checkk\ #3 \arr (#4, #5)}}
\newcommand{\checkClause}[2]{\ensuremath{#1 \vdash \checkc\ #2}}

% \newcommand{\ruleCheckName}[1]{\ensuremath{C_{#1}}\xspace}
\newcommand{\ruleCheckName}[2]{\customlabel{#1}{\ensuremath{C_{#2}}}}

\newcommand{\ruleCheckClause}{\ruleCheckName{rule:check-clause}{\cdash}}
\newcommand{\ruleCheckClauseM}[1]{
  \begin{myRule}{#1}
    % Clause
    \AxiomC{\assumeCmd{\ctx}{(\get{i}\ \pred)}{i}{\ctx[']}}
    \AxiomC{\checkCmd{\ctx[']}{\detI}{B}{\ctx['']}{\func}}
    \AxiomC{\subCmd{\inferCmd{\ctx['']}{o}}{\getO{\pred}}}
    \AxiomC{\subCmd{\func}{\getF{\pred}}}
    \RightLabelM{\ruleCheckClause}
    \QuaternaryInfC{\checkClause{\ctx}{(\clauseCmd{\pred}{i\ o}{B})}}
  \end{myRule}
}

\newcommand{\ruleCheckCut}{\ruleCheckName{rule:check-cut}{!}}
\newcommand{\ruleCheckCutM}[1]{
  \begin{myRule}{#1}
    % CUT
    \AxiomC{\checkCmd{\ctx}{\detI}{L}{\ctx[']}{\func[']}}
    \RightLabelM{\ruleCheckCut}
    \UnaryInfC{\checkCmd{\ctx}{\_}{\ConsHd{\cut}\ConsTl{L}}{\ctx[']}{\func[']}}
  \end{myRule}
}

\newcommand{\ruleCheckUnif}{\ruleCheckName{rule:check-unif}{=}}
\newcommand{\ruleCheckUnifM}[1]{
  \begin{myRule}{#1}
    % UNIF
    \AxiomC{
      \stackanchor
      {\ensuremath{\inferCmdArr{\ctx}{A}{\func[_A]}}}
      {\ensuremath{\inferCmdArr{\ctx}{B}{\func[_B]}}}}
    % \AxiomC{\ensuremath{\func{_{AB}} = \minT\ \func{_A}\ \func{_B}}}
    \AxiomC{
      \stackanchor
      {\ensuremath{\func{_{AB}} = \minT\ \func{_A}\ \func{_B}}}
      {\stackanchor
        {\ensuremath{\assumeCmd{\ctx}{\func{_{AB}}}{A}{\ctx[']}}}
        {\ensuremath{\assumeCmd{\ctx[']}{\func{_{AB}}}{B}{\ctx['']}}}}}
    \AxiomC{\checkCmd{\ctx['']}{\func}{L}{\ctx[''']}{\func[']}}
    \RightLabelM{\ruleCheckUnif}
    \TrinaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{A = B}\ConsTl{L}}{\ctx[''']}{\func[']}}
  \end{myRule}
}

% \newcommand{\ruleCheckMatch}{\ruleCheckName{m}}
% \newcommand{\ruleCheckMatchM}[1]{
%   \begin{myRule}{#1}
%     % MATCH
%     \AxiomC{\checkCmd{\ctx + \{A \mapsto B; B \mapsto \min A\ B\}}{\func}{L}{\ctx[']}{\func[']}}
%     \RightLabelM{\ruleCheckMatch}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{A = B}\ConsTl{L}}{\ctx[']}{\func[']}}
%   \end{myRule}
% }

% \newcommand{\ruleCheckImpl}{\ruleCheckName{\Rightarrow}}
% \newcommand{\ruleCheckImplM}[1]{
%   \begin{myRule}{#1}
%     % IMPL
%     % \AxiomC{\checkClause{\ctx}{H}}
%     \AxiomC{\checkCmd{\ctx}{\func}{\ConsHd{B}\ConsTl{L}}{\ctx[']}{\func[']}}
%     \RightLabelM{\ruleCheckImpl}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{\implCmd{H}{B}}\ConsTl{L}}{\ctx[']}{\func[']}}
%   \end{myRule}
% }

% \newcommand{\ruleCheckPi}{\ruleCheckName{\forall}}
% \newcommand{\ruleCheckPiM}[1]{
%   \begin{myRule}{#1}
%     % PI
%     \AxiomC{\checkCmd{\ctx + \{x \mapsto \toF\ x\}}{\func}{\ConsHd{B}\ConsTl{L}}{\ctx[']}{\func[']}}
%     \RightLabelM{\ruleCheckPi}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{\piCmd{x}{B}}\ConsTl{L}}{\ctx[']}{\func[']}}
%   \end{myRule}
% }

\newcommand{\ruleCheckPiImpl}{\ruleCheckName{rule:check-ho}{\piimpl}}
\newcommand{\ruleCheckPiImplM}[1]{
  \begin{myRule}{#1}
    % PiImpl
    \AxiomC{\checkClause{\ctx}{H}}
    \AxiomC{\checkCmd{\ctx + \{x \mapsto ty\}}{\func}{\ConsHd{B}\ConsTl{L}}{\ctx[']}{\func[']}}
    \RightLabelM{\ruleCheckPiImpl}
    \BinaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{\piImplCmd[ty]{x}{H}{B}}\ConsTl{L}}{\ctx[']}{\func[']}}
  \end{myRule}
}

\newcommand{\predVar}{\texttt{v}}

\newcommand{\ruleCheckCall}{\ruleCheckName{rule:check-callOK}{@}}
\newcommand{\ruleCheckCallM}[1]{
  \begin{myRule}{#1}
    % CALL SUCC
    \AxiomC{\inferCmdArr{\ctx}{(\predVar\ i\ o)}{\func[']}}
    \AxiomC{\assumeCmd{\ctx}{(\get{o}\ \predVar)}{o}{\ctx[']}}
    \AxiomC{\checkCmd{\ctx[']}{\maxT\ \func\ \func[']}{L}{\ctx['']}{\func['']}}
    \RightLabelM{\ruleCheckCall}
    \TrinaryInfC{\checkCmd{\ctx}{\func}{\ConsHd{\predVar\ i\ o}\ConsTl{L}}{\ctx['']}{\func['']}}
  \end{myRule}
}

\newcommand{\ruleCheckCallFail}{\ruleCheckName{rule:check-callKO}{\bot}}
\newcommand{\ruleCheckCallFailM}[1]{
  \begin{myRule}{#1}
    % CALL FAIL
    \AxiomC{$\lnot (\inferCmdArr{\ctx}{(\predVar\ i\ o)}{\_})$}
    \AxiomC{\checkCmd{\ctx + \UCmd{\ctx}{\bot}{o}}{\relI}{L}{\ctx[']}{\func[']}}
    \RightLabelM{\ruleCheckCallFail}
    \BinaryInfC{\checkCmd{\ctx}{\_}{\ConsHd{\predVar\ i\ o}\ConsTl{L}}{\ctx[']}{\func[']}}
  \end{myRule}
}


\newcommand{\ruleCheckEmpty}{\ruleCheckName{rule:check-stop}{\EmptyList}}
\newcommand{\ruleCheckEmptyM}[1]{
  \begin{myRule}{#1}
    % EMPTY
    \AxiomC{}
    \RightLabelM{\ruleCheckEmpty}
    \UnaryInfC{\checkCmd{\ctx}{\func}{\EmptyList}{\ctx}{\func}}
  \end{myRule}
}

\newcommand{\staticCheckFig}{
  \begin{figure}
    \centering

    \ruleCheckClauseM{1}


    \ruleCheckCutM{.45}
    \ruleCheckEmptyM{.35}

    % \ruleCheckPiM{.5}
    \ruleCheckPiImplM{1}

    \ruleCheckUnifM{1}

    % \ruleCheckMatchM{.7}
    \ruleCheckCallM{1}
    \ruleCheckCallFailM{1}

    \caption{Static determinacy checker rules}
    \label{fig:static-check}
  \end{figure}
}