
% [checkCmd ctx1 func1 tm ctx2 func2]
\newcommand{\checkL}{\texttt{check}\ensuremath{_L}}
\newcommand{\checkCmd}[5]{\ensuremath{\checkk\ #3\ (#1,\ #2)\ \arr (#4, #5)}}
\newcommand{\checkLCmd}[5]{\ensuremath{\checkL\ #3\ #1\ #2\ \arr (#4, #5)}}
\newcommand{\checkClause}[2]{\ensuremath{\checkc\ #1\ #2}}

% \newcommand{\ruleCheckName}[1]{\ensuremath{C_{#1}}\xspace}
\newcommand{\ruleCheckName}[2]{\customlabel{#1}{\ensuremath{C_{#2}}}}

\newcommand{\ruleCheckClause}{\ruleCheckName{rule:check-clause}{\cdash}}
\newcommand{\ruleCheckClauseM}[1]{
  \begin{myRule}{#1}
    % Clause
    \AxiomC{
      \stackanchor
        {$\ctx\ \predVar = \dtype{\func}{\func[_i]}{\func[_o]}$}
        {\fold\ \assumeCmd{\ctx}{\vecL{(\func[_i],t_i)}}{\!\!}{\ctx[']}}
    }
    \AxiomC{
      \stackanchor
      {\fold\ \checkCmd{\ctx[']}{\detI}{\vecL{bs}}{\ctx['']}{\func[']}}
      {\ensuremath{\map\ \inferCmdArr[1]{\ctx['']}{\vecL{t_o}}{(\func[_o'],\top)}}}}
    \AxiomC{
      \stackanchor
      {\subCmd{\func'}{\func}}
      {\func[_o'] \mySub \func[_o]}
    }
    \RightLabelM{\ruleCheckClause}
    \TrinaryInfC{\checkClause{\ctx}{(\clauseCmd{\pred}{\vec{t}}{\vecL{bs}})}}
  \end{myRule}
}

\newcommand{\ruleCheckCut}{\ruleCheckName{rule:check-cut}{!}}
\newcommand{\ruleCheckCutM}[1]{
  \begin{myRule}{#1}
    % CUT
    \AxiomC{}
    \RightLabelM{\ruleCheckCut}
    \UnaryInfC{\checkCmd{\ctx}{\_}{\cut}{\ctx}{\detI}}
  \end{myRule}
}

\newcommand{\ruleCheckUnif}{\ruleCheckName{rule:check-unif}{=}}
\newcommand{\ruleCheckUnifM}[1]{
  \begin{myRule}{#1}
    % UNIF
    \AxiomC{
      \stackanchor
      {\ensuremath{\inferCmdArr{\ctx}{A}{(\func[_A],\top)}}}
      {\ensuremath{\inferCmdArr{\ctx}{B}{(\func[_B],\top)}}}}
    \AxiomC{\ensuremath{\func{_{AB}} = \minT\ \func{_A}\ \func{_B}}}
    % \AxiomC{\ensuremath{\func{_{AB}} = \minT\ \func{_A}\ \func{_B}}}
    \AxiomC{
      \stackanchor
      {\ensuremath{\assumeCmd{\ctx}{\func{_{AB}}}{A}{\ctx[']}}}
      {\ensuremath{\assumeCmd{\ctx[']}{\func{_{AB}}}{B}{\ctx['']}}}}
    \RightLabelM{\ruleCheckUnif}
    \TrinaryInfC{\checkCmd{\ctx}{\func}{(A = B)}{\ctx['']}{\func}}
  \end{myRule}
}

\newcommand{\ruleCheckUnifFail}{\ruleCheckName{rule:check-unifFail}{{\neq}}}
\newcommand{\ruleCheckUnifFailM}[1]{
  \begin{myRule}{#1}
    % UNIF FAIL
    \AxiomC{\ensuremath{\inferCmdArr{\ctx}{A}{(\_,\bot)} \lor \inferCmdArr{\ctx}{B}{(\_,\bot)}}}
    \RightLabelM{\ruleCheckUnifFail}
    \UnaryInfC{\checkCmd{\ctx}{\func}{(A = B)}{\ctx}{\func}}
  \end{myRule}
}

\newcommand{\ruleCheckPiImpl}{\ruleCheckName{rule:check-piimpl}{\piimpl}}
\newcommand{\ruleCheckPiImplM}[1]{
  \begin{myRule}{#1}
    % PiImpl
    \AxiomC{\checkClause{\ctx}{H}}
    \AxiomC{\checkCmd{\ctx + \{x \mapsto ty\}}{\func}{B}{\ctx[']}{\func[']}}
    \RightLabelM{\ruleCheckPiImpl}
    \BinaryInfC{\checkCmd{\ctx}{\func}{(\piImplCmd[ty]{x}{H}{B})}{\ctx[']\bs \{x\}}{\func[']}}
  \end{myRule}
}

\newcommand{\predVar}{\texttt{v}}

% \newcommand{\ruleCheckCall}{\ruleCheckName{rule:check-callOK}{@}}
% \newcommand{\ruleCheckCallM}[1]{
%   \begin{myRule}{#1}
%     % CALL SUCC
%     \AxiomC{\ensuremath{\ctx\ \predVar = \dtype{\func[']}{[\func[_i]]}{[\func[_o]]}}}
%     \AxiomC{\inferCmdArr{\ctx}{i}{\func[_i']}{\top}}
%     \AxiomC{\ensuremath{\func[_i'] \mySub \func[_i]}}
%     \AxiomC{\assumeCmd{\ctx}{\func[_o]}{o}{\ctx[']}}
%     \RightLabelM{\ruleCheckCall}
%     \QuaternaryInfC{\checkCmd{\ctx}{\func}{(\predVar\ i\ o)}{\ctx[']}{\maxT\ \func\ \func[']}}
%   \end{myRule}
% }
\def\stackalignment{l}
\newcommand{\ruleCheckCall}{\ruleCheckName{rule:check-callOK}{@^\top}}
\newcommand{\ruleCheckCallM}[1]{
  \begin{myRule}{#1}
    % CALL SUCC
    % \AxiomC{
    %   \stackanchor{\ensuremath{\ctx\ \predVar = \dtype{\func[']}{[\func[_i]]}{[\func[_o]]}}}
    %   {\inferCmdArr{\ctx}{i}{\func[_i']}{\mathcal{R}}}}
    \AxiomC{
      \stackanchor{\ensuremath{%
          \ctx\ \predVar = \dtype{\func[']}{\func[_i]}{\func[_o]} \qquad
          \map\ \inferCmdArr[1]{\ctx}{\vecL{t_i}}{\vecL{(\func[_i'],\top)}}}
        }{\ensuremath{%
          \vecL{\func[_i'] \mySub \func[_i]} \qquad\qquad\quad\ \ \ \!
          \fold\ \assumeCmd{\ctx}{\vecL{(\func[_o],t_o)}}{\!\!\!}{\ctx[']}}}}
      
    % \AxiomC{
    %   \stackanchor
    %   {\ensuremath{\text{if } \mathcal{R}}}
    %   {\stackanchor
    %     {then $\func[''] = \maxT\ \func\ \func[']$}
    %     {else $\func[''] = \relI$}}}
    \RightLabelM{\ruleCheckCall}
    \UnaryInfC{\checkCmd{\ctx}{\func}{(\predVar\ \vec{t})}{\ctx[']}{\maxT\ \func\ \func[']}}
  \end{myRule}
}

\newcommand{\ruleCheckCallFail}{\ruleCheckName{rule:check-callKO}{@_\bot}}
\newcommand{\ruleCheckCallFailM}[1]{
  \begin{myRule}{#1}
    % CALL FAIL
    \AxiomC{\ensuremath{ \ctx\ \predVar = \dtype{\_}{\func[_i]}{\_} }}
    \AxiomC{ \map\ \inferCmdArr[1]{\ctx}{\vecL{t_i}}{\vecL{(\func['],\bool)}}}
    \AxiomC{$ \exists i,\func[_i'] \not\mySub \func[_i]\ \lor\ \exists i, \bool_i = \bot$}
    \RightLabelM{\ruleCheckCallFail}
    \TrinaryInfC{\checkCmd{\ctx}{\_}{(\predVar\ \vec{t})}{\ctx}{\relI}}
  \end{myRule}
}


% \newcommand{\ruleCheckEmptyM}[1]{
%   \begin{myRule}{#1}
%     % EMPTY
%     \AxiomC{}
%     \RightLabelM{\ruleCheckEmpty}
%     \UnaryInfC{\checkCmd{\ctx}{\func}{\EmptyList}{\ctx}{\func}}
%   \end{myRule}
% }

\newcommand{\ruleCheckEmpty}{\ruleCheckName{rule:check-stop}{\EmptyList}}
\newcommand{\ruleCheckListEmpty}[1]{
  % EMPTY
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleCheckEmpty}
    \UnaryInfC{\checkLCmd{\ctx}{\func}{\EmptyList}{\ctx}{\func}}
  \end{myRule}
}

\newcommand{\ruleCheckCons}{\ruleCheckName{rule:check-cons}{::}}
\newcommand{\ruleCheckListCons}[1]{
  % CONS
  \begin{myRule}{#1}
    \AxiomC{\checkCmd{\ctx}{\func}{\EmptyList}{\ctx[']}{\func[']}}
    \AxiomC{\checkLCmd{\ctx[']}{\func[']}{\EmptyList}{\ctx['']}{\func['']}}
    \RightLabelM{\ruleCheckCons}
    \BinaryInfC{\checkLCmd{\ctx}{\func}{\ConsHd{h}\ConsTl{t}}{\ctx['']}{\func['']}}
  \end{myRule}
}

\newcommand{\checkTermFig}{
  \begin{subfigure}[b]{1\textwidth}
    \centering

    \ruleCheckCutM{.45}

    % \ruleCheckPiM{.5}
    % \ruleCheckPiImplM{1}

    % \ruleCheckUnifM{1}
    % \ruleCheckUnifFailM{0.52}
    
    % \ruleCheckMatchM{.7}
    \ruleCheckCallM{1}
    \ruleCheckCallFailM{1}

%     \caption{\checkk\ relation}
%     \label{fig:static-check-term}
%   \end{subfigure}
% }

% \newcommand{\staticCheckFig}{
%   \begin{subfigure}[b]{1\textwidth}
%     \centering
    \ruleCheckClauseM{1}

    % \ruleCheckListEmpty{.38}
    % \ruleCheckListCons{1}

    % \caption{Determinacy clause checking}
    \label{fig:static-check}
  \end{subfigure}
}