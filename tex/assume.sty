

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ASSUME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\assume}{\texttt{assume}\xspace}

%         inp     inp       inp    out
% \assumeCmd{ctx}{determinacy}{term}{new_ctx}
\newcommand{\assumeCmd}[5][]{\ensuremath{
    \ifstrequal{#1}{1}
    {\vecL{\assume\ #3\ #4\ #2}}
    {\assume\ #3\ #4\ #2} \arr #5}}

\newcommand{\ruleAssume}[2]{\customlabel{#1}{\ensuremath{A_{#2}}}}

\newcommand{\ruleAssumeCut}{\ruleAssume{rule:assume-cut}{!}}
\newcommand{\assumeCut}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleAssumeCut}
    \UnaryInfC{\assumeCmd{\ctx}{\_}{\cut}{\ctx}}
  \end{myRule}
}

% \newcommand{\ruleAssumeExpr}{\ruleAssume{rule:assume-expr}{\expr}}
% \newcommand{\assumeExpr}[1]{
%   \begin{myRule}{#1}
%     \AxiomC{}
%     \RightLabelM{\ruleAssumeExpr}
%     \UnaryInfC{\assumeCmd{\ctx}{\_}{\expr}{\ctx}}
%   \end{myRule}
% }

\newcommand{\ruleAssumePiImpl}{\ruleAssume{rule:assume-piimpl}{\piimpl}}
\newcommand{\assumePiImpl}[1]{
  \begin{myRule}{#1}
    \AxiomC{\assumeCmd{(\ctx + \{x \mapsto sig\})}{\func}{B}{\ctx[']}}
    \RightLabelM{\ruleAssumePiImpl}
    \UnaryInfC{\assumeCmd{\ctx}{\func}{(\piImplCmd[sig]{x}{H}{B})}{\ctx[']\bs \{x\}}}
  \end{myRule}
}

\newcommand{\ruleAssumeUnif}{\ruleAssume{rule:assume-unif}{=}}
\newcommand{\assumeUnif}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleAssumeUnif}
    \UnaryInfC{\assumeCmd{\ctx}{\_}{(\_ = \_)}{\ctx}}
  \end{myRule}
}

% \newcommand{\ruleAssumeApp}{\ruleAssume{rule:assume-app}{@}}
% \newcommand{\assumeApp}[1]{
%   \begin{myRule}{#1}
%     \AxiomC{\assumeCmd{\ctx}{\func}{t}{\ctx[']}}
%     \RightLabelM{\ruleAssumeApp}
%     \UnaryInfC{\assumeCmd{\ctx}{\func}{(t\ t_1\ t_2)}{\ctx[']}}
%   \end{myRule}
% }

\newcommand{\ruleAssumeHd}{\ruleAssume{rule:assume-hd}{\X}}
\newcommand{\assumeHd}[1]{
  \begin{myRule}{#1}
    \AxiomC{$\texttt{\func['] = \minT\ \func\ (\ctx\ \predVar) }$}
    \RightLabelM{\ruleAssumeHd}
    \UnaryInfC{\assumeCmd{\ctx}{\func}{\X}{\ctx + \{\predVar \mapsto \func[']\}}}
  \end{myRule}
}

\newcommand{\ruleAssumeExpr}{\ruleAssume{rule:assume-expr}{K}}
\newcommand{\assumeExpr}[1]{
  \begin{myRule}{#1}
    \AxiomC{}% \quad \ctx\ \predVar \mySub \func$ }
    \RightLabelM{\ruleAssumeExpr}
    \UnaryInfC{\assumeCmd{\ctx}{\func}{(K\ \vecL{\T})}{\ctx}}
  \end{myRule}
}


\newcommand{\ruleAssumeApp}{\ruleAssume{rule:assume-app}{@}}
\newcommand{\assumeApp}[1]{
  \begin{myRule}{#1}
    % APP
    \AxiomC{\ensuremath{
      \ctx\ P = \dtype{\func[']}{\func[_i]}{\_}\qquad
      \textbf{if } \func['] \mySub \func
      \textbf{ then }\assumeCmd[1]{\ctx}{\func[_i]}{\T_i}{\ctx[']}
      \textbf{ else }\ctx['] = \ctx  
    }}
    \RightLabelM{\ruleAssumeApp}
    \UnaryInfC{\assumeCmd{\ctx}{\func}{(P\ \vecL{\T})}{\ctx[']}}
  \end{myRule}
}

\newcommand{\ruleAssumeLam}{\ruleAssume{rule:assume-lam}{\lambda}}
\newcommand{\assumeLam}[1]{
  \begin{myRule}{#1}
    \AxiomC{\ensuremath{
        \textbf{if } sig \mySub \func[_x] 
        \textbf{ then } \assumeCmd{(\ctx + \{x:sig\})}{(\dtype{\func}{\func[_i]}{\func[_o]})}{\T}{\ctx[']}
        \textbf{ else } \ctx['] = \ctx}}
    \RightLabelM{\ruleAssumeLam}
    \UnaryInfC{\assumeCmd{\ctx}{(\dtype{\func}{(\func[_x]::\func[_i])}{\func[_o]})}{(\lambda x:sig.\T)}{\ctx['] \bs \{x\}}}
  \end{myRule}
}

\newcommand{\assumeFig}{
  % \begin{subfigure}[b]{1\textwidth}
  \begin{figure}
    \vspace{-2.1em}
    \begin{framed}

      \centering

      \assumeHd{0.45}
      \assumeExpr{0.45}
      \assumeCut{0.4}
      \assumePiImpl{0.55}
            
      % \assumeUnif{0.3}

      \assumeLam{1}
      \assumeApp{1}

      \vspace{-1em}
      \caption{\assume\ routine}
      \label{fig:det-assume}
    \end{framed}
  \end{figure}
}