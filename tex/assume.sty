

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ASSUME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\assume}{\texttt{assume}}

%         inp     inp       inp    out
% \assumeCmd{ctx}{determinacy}{term}{new_ctx}
\newcommand{\assumeCmd}[4]{\ensuremath{\assume\ #1\ #2\ #3 \arr #4}}

\newcommand{\ruleAssume}[2]{\customlabel{#1}{\ensuremath{A_{#2}}}}

\newcommand{\ruleAssumeCut}{\ruleAssume{rule:assume-cut}{!}}
\newcommand{\assumeCut}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleAssumeCut}
    \UnaryInfC{\assumeCmd{\ctx}{\_}{\cut}{\ctx}}
  \end{myRule}
}

\newcommand{\ruleAssumePiImpl}{\ruleAssume{rule:assume-piimpl}{\piimpl}}
\newcommand{\assumePiImpl}[1]{
  \begin{myRule}{#1}
    \AxiomC{\assumeCmd{(\ctx + \{x \mapsto ty\})}{\func}{B}{\ctx[']}}
    \RightLabelM{\ruleAssumePiImpl}
    \UnaryInfC{\assumeCmd{\ctx}{\func}{(\piImplCmd[ty]{x}{H}{B})}{\ctx[']\bs \{x\}}}
  \end{myRule}
}

\newcommand{\ruleAssumeUnif}{\ruleAssume{rule:assume-unif}{=}}
\newcommand{\assumeUnif}[1]{
  \begin{myRule}{#1}
    \AxiomC{}
    \RightLabelM{\ruleAssumeUnif}
    \UnaryInfC{\assumeCmd{\ctx}{\_}{(\_ = \_)}{\ctx}}
  \end{myRule}
}

% \newcommand{\ruleAssumeApp}{\ruleAssume{rule:assume-app}{@}}
% \newcommand{\assumeApp}[1]{
%   \begin{myRule}{#1}
%     \AxiomC{\assumeCmd{\ctx}{\func}{t}{\ctx[']}}
%     \RightLabelM{\ruleAssumeApp}
%     \UnaryInfC{\assumeCmd{\ctx}{\func}{(t\ t_1\ t_2)}{\ctx[']}}
%   \end{myRule}
% }

\newcommand{\ruleAssumeHd}{\ruleAssume{rule:assume-hd}{\predVar}}
\newcommand{\assumeHd}[1]{
  \begin{myRule}{#1}
    \AxiomC{$\texttt{is\_var\ \predVar} \lor \ctx\ \predVar = \func$ }
    \RightLabelM{\ruleAssumeHd}
    \UnaryInfC{\assumeCmd{\ctx}{\func}{\predVar}{\ctx + \{\predVar \mapsto \func\}}}
  \end{myRule}
}


\newcommand{\ruleAssumeApp}{\ruleAssume{rule:assume-app}{@}}
\newcommand{\assumeApp}[1]{
  \begin{myRule}{#1}
    % APP
    \AxiomC{\ensuremath{\ctx\ \predVar = \dtype{\func[']}{[\func[_i]]}{\_}}}
    \AxiomC{\ensuremath{\func['] \mySub \func}}
    \AxiomC{\assumeCmd{\ctx}{\func[_i]}{t_1}{\ctx[']}}
    \RightLabelM{\ruleAssumeApp}
    \TrinaryInfC{\assumeCmd{\ctx}{\func}{(\predVar\ t_1\ t_2)}{\ctx[']}}
  \end{myRule}
}

\newcommand{\assumeFig}{
  \begin{subfigure}[b]{1\textwidth}
    \centering

    \assumeHd{0.35}
    \assumeUnif{0.32}

    \assumeCut{0.28}
    \assumePiImpl{0.5}

    % \assumeApp{0.33} 
    \assumeApp{1}
 
    \caption{\assume\ relation}
    \label{fig:det-assume}
  \end{subfigure}
}