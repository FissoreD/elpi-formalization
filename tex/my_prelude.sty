\usepackage[newfloat,outputdir=.aux]{minted}
\usepackage{bussproofs}
\usepackage{xspace}
\usepackage{mathtools}
\usepackage{multicol}
\usepackage{todonotes}
\usepackage{blindtext}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{mdframed}  % For creating a bordered box
\usepackage{amsmath}
\usepackage{amssymb}
% \usepackage{amsthm}
\usepackage{simplebnf}
\usepackage{stackengine}
\usepackage{subcaption}
\usepackage{framed}
\usepackage{accents}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem{corollary}{Corollary}

\newcommand{\vecL}[1]{\overrightarrow{#1}}

% \expandafter\def\expandafter\normalsize\expandafter{%
% \normalsize%
% \setlength{\belowdisplayskip}{3pt}%
% \setlength{\abovedisplayskip}{3pt}%
% \setlength{\abovedisplayshortskip}{3pt}%
% \setlength{\belowdisplayshortskip}{3pt}%
% }

\makeatletter
\newcommand{\customlabel}[2]{%
  \protected@write \@auxout {}{\string \newlabel {#1}{{\ensuremath{#2}}{\thepage}{#2}{#1}{}} }%
  \hypertarget{#1}{\ensuremath{#2}}
}
\makeatother

% \usepackage{amssymb}% http://ctan.org/pkg/amssymb
\usepackage{pifont}% http://ctan.org/pkg/pifont
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%

\newcommand{\subst}[1][]{\ensuremath{\sigma#1}\xspace}
\newcommand{\alt}[1][]{\ensuremath{\mathcal{A}#1}\xspace}
\newcommand{\alts}[1][]{\ensuremath{a#1}\xspace}
\newcommand{\g}[1][]{\ensuremath{\mathcal{G}#1}\xspace}
\newcommand{\gl}[1][]{\ensuremath{gl#1}\xspace}
\newcommand{\clause}[1][]{\ensuremath{\mathcal{@}#1}\xspace}
\newcommand{\pred}[1][]{\texttt{p#1}\xspace}
\newcommand{\expr}[1][]{\texttt{e#1}\xspace}
\newcommand{\isFuncCmd}[1]{\ensuremath{\runCmd{[\goalCmd{\prog}{#1}{\EmptyList}]}{\EmptyList}{\EmptySubst}{a}{\subst} \to 
  \forall a_i \in a, \lnot 
  (\exists \alt\ \subst['], \runCmd{a_i}{\EmptyList}{\EmptySubst}{\alt}{\subst[']})
}}
\newcommand{\isDetCmd}[1]{\ensuremath{\runCmd{[\goalCmd{\prog}{#1}{\EmptyList}]}{\EmptyList}{\EmptySubst}{a}{\subst} \to 
 a = \EmptyList
}}
\newenvironment{boxedproof}
{\begin{mdframed}\begin{proof}}
      {\end{proof}\end{mdframed}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Languages: start

\newcommand{\txt}[1]{\texttt{#1}}
\newcommand{\lang}[1]{\texttt{#1}\xspace}

\newcommand{\prolog}{\lang{prolog}}
\newcommand{\mixtus}{\lang{mixtus}}
\newcommand{\mercury}{\lang{mercury}}
\newcommand{\twelf}{\lang{twelf}}
\newcommand{\elpi}{\lang{elpi}}
\newcommand{\coq}{\lang{coq}}

\newcommand{\Mercury}{\lang{Mercury}}
\newcommand{\Elpi}{\lang{Elpi}}
\newcommand{\Coq}{\lang{Coq}}
\newcommand{\lamprolog}{\lang{$\lambda$prolog}}
\newcommand{\pf}{\ensuremath{L_\lambda}}

% Languages: end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{myminted}[2][~~]{
  \vspace{0.2em}%
  \VerbatimEnvironment
  \begin{minted}[fontsize=\small,autogobble,escapeinside=#1,mathescape=true,frame=leftline,framerule=0pt,framesep=1em]{#2}%
}{
  \end{minted}%
  \vspace{0.2em}%
}
\newenvironment{mymintedln}[2][~~]{
  \vspace{0.2em}%
  \VerbatimEnvironment
  \begin{minted}[linenos,fontsize=\small,autogobble,escapeinside=#1,mathescape=true,frame=leftline,framerule=0pt,framesep=1em]{#2}%
}{
  \end{minted}%
  \vspace{0.2em}%
}

\newenvironment{elpicode}{\VerbatimEnvironment\begin{myminted}{'elpi.py:ElpiLexer -x'}}{\end{myminted}}
\newenvironment{elpicodeln}{\VerbatimEnvironment\begin{mymintedln}{'elpi.py:ElpiLexer -x'}}{\end{mymintedln}}
\newenvironment{coqcode}{\VerbatimEnvironment\begin{myminted}{coq}}{\end{myminted}}

\newcommand{\elpiIn}[1]{\mintinline[fontsize=\small,escapeinside=~~]{'elpi.py:ElpiLexer -x'}{#1}}
\newcommand{\modeAlone}[1]{\elpiIn{~\PYG{k+kMode}{#1:}~}}
\newcommand{\uvar}{\elpiIn{uvar}\xspace}

\newcommand{\coqIn}[1]{\mintinline[fontsize=\small,escapeinside=~~]{coq}{#1}}
\newcommand{\mlIn}[1]{\mintinline[fontsize=\small,escapeinside=~~]{ocaml}{#1}}


% goal{program}{goal}{alternatives}
\newcommand{\run}{\texttt{run}}
\newcommand{\call}{\texttt{Call}}
\newcommand{\cut}{\texttt{Cut}}
%\newcommand{\goal}{\texttt{Goal}}
\newcommand{\unifiable}{\texttt{unifiable}\xspace}
\newcommand{\nUnify}{\texttt{split}\xspace}
\newcommand{\unify}{\texttt{unify}\xspace}
\newcommand{\match}{\texttt{match}\xspace}
\newcommand{\impl}{\texttt{=>}}
\renewcommand{\pi}{\texttt{pi}}
\newcommand{\cdash}{\texttt{:-}} % colon-dash
\newcommand{\tailcut}{\texttt{tail\_cut}\xspace}
\newcommand{\arr}{\ensuremath{\rightsquigarrow}}

\def\mutExclHeads{\texttt{split\_heads}}
\def\locExcl{\texttt{loc\_excl}}
\def\mutExcl{\texttt{mut\_excl}}
\def\mutExclHO{\texttt{mut\_excl\_HO}}
\def\detCheck{\texttt{det\_check}}
\def\detCheckHO{\texttt{det\_check\_HO}}
\newcommand{\lam}{\ensuremath{\lambda}}

\def\mutExclCut{\texttt{mut\_excl\_cut}}
\def\detPrem{\texttt{det\_prem}}
\def\wellModed{\texttt{well\_moded}}
\newcommand{\ground}{\texttt{ground}}
\newcommand{\dom}{\texttt{dom}}
\newcommand{\bs}{\text{\textbackslash}}

% runCmd{goal[]}{alts[]}{subst}{alts_res}{subst_res}
\newcommand{\runCmd}[5]{\ensuremath{\run\ (#3,\ #1)\ #2 \arr (#4, #5)}}
\newcommand{\runCmdQ}[4]{\ensuremath{\run\ #1\ #2 \arr (#3, #4)}}
% \newcommand{\callCmd}[3]{\ensuremath{(\call\ #1\ #2\ #3)}\xspace}
\newcommand{\callCmd}[2]{\ensuremath{(#1\ #2)}\xspace}
\newcommand{\goalCmd}[3]{\ensuremath{(#1,\ #2,\ #3)}\xspace}
\newcommand{\clauseCmd}[3]{\ensuremath{#1\ #2\ \cdash\ #3}}
\newcommand{\implCmd}[2]{\ensuremath{#1\ \impl\ #2}}
\newcommand{\piCmd}[3][]{\ensuremath{\pi\ #2\expandafter\ifx\expandafter\relax
      \detokenize{#1}\relax\else{ : #1}\fi\bs\ #3}}
\newcommand{\lamCmd}[2]{\ensuremath{\lambda#1. #2}}

\newcommand{\piImplCmd}[4][]{\piCmd[#1]{#2}{\implCmd{#3}{#4}}}

\newcommand{\unifyCmd}[5][]{\ensuremath{
  \ifstrequal{#1}{1}
    {\vecL{\unify\ #2\ #3}}
    {\unify\ #2\ #3}\ #4 \arr #5}}
\newcommand{\matchCmd}[5][]{\ensuremath{
  \ifstrequal{#1}{1}
  {\vecL{\match\ #2\ #3}}
  {\match\ #2\ #3}\ #4 \arr #5}}

\newcommand{\tailcutCmd}[2]{\ensuremath{\tailcut\ #1\ #2}\xspace}

\newcommand{\Cons}[1]{\ensuremath{#1::}}
\newcommand{\ConsHd}[1]{\ensuremath{(#1::}\xspace}
\newcommand{\ConsTl}[1]{\ensuremath{#1)}\xspace}
\newcommand{\EmptyList}{\ensuremath{\varnothing}}
\newcommand{\ConsHdNP}[1]{\ensuremath{#1::}\xspace}
\newcommand{\ConsTlNP}[1]{\ensuremath{#1}\xspace}

\newcommand{\EmptySubst}{\ensuremath{\varepsilon}}

\newcommand{\prog}[1][]{\ensuremath{\mathcal{P}#1}\xspace}
\newcommand{\progCut}{\ensuremath{\prog[^!]}\xspace}
\newcommand{\evdash}{\ensuremath{\colondash}\xspace}
\newcommand{\piimpl}{{\ensuremath{\forall\Rightarrow}}}

\newenvironment{myRule}[1]{%
  \begin{minipage}{#1\textwidth}
    \centering
    \begin{prooftree}%
      } % Here will be put the body
      {
    \end{prooftree}
    \vspace{2pt}
  \end{minipage}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Static check rule system: start
\newcommand{\detT}[1]{\texttt{#1}}
\newcommand{\maxT}{\texttt{max}}
\newcommand{\minT}{\texttt{min}}
\newcommand{\detI}{\detT{func}}
\newcommand{\isdet}{\detT{is\_det}}
\newcommand{\isfunc}{\detT{is\_func}}
\newcommand{\relI}{\detT{pred}}
\newcommand{\expI}{\detT{exp}}
\newcommand{\funsep}{\ensuremath{\triangleright}}
\newcommand{\dtype}[3]{\ensuremath{#1\ #2 \funsep #3}}
\newcommand{\myTo}{\ensuremath{\mathbin{\detT{->}}}}
\newcommand{\mySub}{\ensuremath{\subseteq}}
\newcommand{\detlab}{\texttt{detlab}}
\newcommand{\toF}{\texttt{ty\_to\_det}\xspace}
\newcommand{\U}{\mathcal{U}}
\newcommand{\UCmd}[3]{\U(#1, #2, #3)}

\newcommand{\bool}{\ensuremath{\mathcal{B}}}
\newcommand{\res}{\ensuremath{\mathcal{R}}}

\newcommand{\func}[1][]{\ensuremath{\mathcal{D}#1}}
\newcommand{\get}[1]{\ensuremath{\texttt{get}_\texttt{#1}}}
\newcommand{\getI}[1]{\ensuremath{\get{i}\ #1}}
\newcommand{\getO}[1]{\ensuremath{\get{o}\ #1}}
\newcommand{\getF}[1]{\ensuremath{\get{D}\ #1}}
\newcommand{\infer}{\texttt{deduce}}
\newcommand{\checkk}{\texttt{check}}
\newcommand{\checkc}{\texttt{check\_clause}}

\newcommand{\subCmd}[2]{\ensuremath{#1 \mySub #2}}
\newcommand{\notSubCmd}[2]{\ensuremath{#1 \not\mySub #2}}

\makeatletter
\def\thm@space@setup{\thm@preskip=0pt
  \thm@postskip=0pt}
\makeatother